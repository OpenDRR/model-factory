-- create schema for new scenario
CREATE SCHEMA IF NOT EXISTS results_nhsl_social_fabric;

DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_s CASCADE;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_s AS
-- 1.0 Human Settlement
-- 1.3 Social Fabric
-- 1.3.1 Housing Conditions
SELECT
a.sauid AS "Sauid",
a."SVIt_Total" AS "SVlt_Score",

a."SVIt_Housing" AS "VHt_Score",

a."PopHa" AS "VH_PopHa",
a."Vn_PopHa" AS "VHn_PopHa",
a."Vt_PopHa" AS "VHt_PopHa",

a."Pre1975" AS "VH_Pre1975",
a."Vn_Pre1975" AS "VHn_Pre1975",
a."Vt_Pre1975" AS "VHt_Pre1975",

a."NSuitHouse" AS "VH_NSuit",
a."Vn_NSuitHouse" AS "VHn_NSuit",
a."Vt_NSuitHouse" AS "VHt_NSuit",

a."MntnAge" AS "VH_MntnAge",
a."Vn_MntnAge" AS "VHn_MntnAge",
a."Vt_MntnAge" AS "VHt_MntnAge",

a."Renter" AS "VH_Renter",
a."Vn_Renter" AS "VHn_Renter",
a."Vt_Renter" AS "VHt_Renter",

a."NonResHa" AS "VH_NonResHa",
a."Vn_NonResHa" AS "VHn_NonResHa",
a."Vt_NonResHa" AS "VHt_NonResHa",

-- 1.0 Human Settlement
-- 1.3 Social Fabric
-- 1.3.2 Family Structure
a."SVIt_Social" AS "VFt_Score",

a."LiveAlone" AS "VF_LivAlone",
a."Vn_LivAlone" AS "VFn_LivAlone",
a."Vt_LivAlone" AS "VFt_LivAlone",

a."LonPar3Kids" AS "VF_LonPar3Kids",
a."Vn_LonPar3Kids" AS "VFn_LonPar3Kids",
a."Vt_LonPar3Kids" AS "VFt_LonPar3Kids",

a."FamGT5" AS "VF_FamGT5",
a."Vn_FamGT5" AS "VFn_FamGT5",
a."Vt_FamGT5" AS "VFt_FamGT5",

a."MovedLT1" AS "VF_MovedLT1",
a."Vn_MovedLT1" AS "VFn_MovedLT1",
a."Vt_MovedLT1" AS "VFt_MovedLT1",

a."ImmLT5" AS "VF_ImmLT5",
a."Vn_ImmLT5" AS "VFn_Imm_LT5",
a."Vt_ImmLT5" AS "VFt_ImmLT5",

a."NoWrkPlace" AS "VF_NoWrkPlace",
a."Vn_NoWrkPlace" AS "VFn_NoWrkPlace",
a."Vt_NoWrkPlace" AS "VFt_NoWrkPlace",

a."Health" AS "VF_Health",
a."Vn_Health" AS "VFn_Health",
a."Vt_Health" AS "VFt_Health",

-- 1.0 Human Settlement
-- 1.3 Social Fabric
-- 1.3.3 Individual Autonomy
a."SVIt_Autonomy" AS "VAt_Score",

a."NoEngFr" AS "VA_NoEngFr",
a."Vn_NoEngFr" AS "VAn_NoEngFr",
a."Vt_NoEngFr" AS "VAt_NoEngFr",

a."NoSecEd" AS "VA_NoSecED",
a."Vn_NoSecEd" AS "VAn_NoSecED",
a."Vt_NoSecEd" AS "VAt_NoSecED",

a."AgeGT65" AS "VA_AgeGT65",
a."Vn_AgeGT65" AS "VAn_AgeGT65",
a."Vt_AgeGT65" AS "VAt_AgeGT65",

a."AgeLT6" AS "VA_AgeLT6",
a."Vn_AgeLT6" AS "VAn_AgeLT6",
a."Vt_AgeLT6" AS "VAt_AgeLT6",

a."Indigenous" AS "VA_Indigenous",
a."Vn_Indigenous" AS "VAn_Indigenous",
a."Vt_Indigenous" AS "VAt_Indigenous",

a."VisMinority" AS "VA_VisMinority",
a."Vn_VisMinority" AS "VAn_VisMinority",
a."Vt_VisMinority" AS "VAt_VisMinority",

a."AgeMedian" AS "VA_AgeMedian",
a."Vn_AgeMedian" AS "VAn_AgeMedian",
a."Vt_AgeMedian" AS "VAt_AgeMedian",
 
a."PubTrans" AS "VA_PubTrans",
a."Vn_PubTrans" AS "VAn_PubTrans",
a."Vt_PubTrans" AS "VAt_PubTrans",

-- 1.0 Human Settlement
-- 1.3 Social Fabric
-- 1.3.4 Financial Agency
a."SVIt_Financial" AS "VEt_Score",

a."ShltrGT30" AS "VE_ShltrGT30",
a."Vn_ShltrGT30" AS "VEn_ShltrGT30",
a."Vt_ShltrGT30" AS "VEt_ShltrGT30",

a."IncLowdec" AS "VE_LowIncDec",
a."Vn_IncLowDec" AS "VEn_LowIncDec",
a."Vt_IncLowDec" AS "VEt_LowIncDec",

a."Unemployed" AS "VE_Unemployed",
a."Vn_Unemployed" AS "VEn_Unemployed",
a."Vt_Unemployed" AS "VEt_Unemployed",

a."IncEmpl" AS "VE_IncEmploy",
a."Vn_IncEmpl" AS "VEn_IncEmploy",
a."Vt_IncEmpl" AS "VEt_IncEmploy",

a."IncInd" AS "VE_IndivInc",
a."Vn_IncInd" AS "VEn_IndivInc",
a."Vt_IncInd" AS "VEt_IndivInc",

a."IncHshld" AS "VE_HshldInc",
a."Vn_IncHshld" AS "VEn_HshldInc",
a."Vt_IncHshld" AS "VEt_HshldInc",

a."Retail" AS "VE_Retail",
a."Vn_Retail" AS "VEn_Retail",
a."Vt_Retail" AS "VEt_Retail",

a."WorkNone" AS "VE_WorkNone",
a."Vn_WorkNone" AS "VEn_WorkNone",
a."Vt_WorkNone" AS "VEt_WorkNone",

a."WorkPart" AS "VE_WorkPart",
a."Vn_WorkPart" AS "VEn_WorkPart",
a."Vt_WorkPart" AS "VEt_WorkPart",

a."OneIncHshld" AS "VE_Mntn1",
a."Vn_OneIncHshld" AS "VEn_Mntn1",
a."Vt_OneIncHshld" AS "VEt_Mntn1",

b."PRUID" AS "pruid",
b."PRNAME" AS "prname",
b."ERUID" AS "eruid",
b."ERNAME" AS "ername",
b."CDUID" AS "cduid",
b."CDNAME" AS "cdname",
b."CSDUID" AS "csduid",
b."CSDNAME" AS "csdname",
b."CFSAUID" AS "fsauid",
b."DAUIDt" AS "dauid",
b."SACCODE" AS "saccode",
b."SACTYPE" AS "sactype",
b.geom AS "geom_poly"

FROM sovi.sovi_sauid_nov2021 a
LEFT JOIN boundaries."Geometry_SAUID" b ON b."SAUIDt" = a.sauid;


-- create views for province
DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_nl CASCADE;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_nl AS 
SELECT * FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s WHERE pruid ='10';

DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_pe CASCADE;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_pe AS 
SELECT * FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s WHERE pruid ='11';

DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_ns CASCADE;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_ns AS 
SELECT * FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s WHERE pruid ='12';

DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_nb CASCADE;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_nb AS 
SELECT * FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s WHERE pruid ='13';

DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_qc CASCADE;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_qc AS 
SELECT * FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s WHERE pruid ='24';

DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_on CASCADE;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_on AS 
SELECT * FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s WHERE pruid ='35';

DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_mb CASCADE;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_mb AS 
SELECT * FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s WHERE pruid ='46';

DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_sk CASCADE;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_sk AS 
SELECT * FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s WHERE pruid ='47';

DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_ab CASCADE;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_ab AS 
SELECT * FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s WHERE pruid ='48';

DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_bc CASCADE;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_bc AS 
SELECT * FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s WHERE pruid ='59';

DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_yt CASCADE;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_yt AS 
SELECT * FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s WHERE pruid ='60';

DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_nt CASCADE;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_nt AS 
SELECT * FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s WHERE pruid ='61';

DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_nu CASCADE;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_s_nu AS 
SELECT * FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s WHERE pruid ='62';
