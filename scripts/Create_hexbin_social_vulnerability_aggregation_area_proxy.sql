-- test aggregation to hexbin grids via area proxy
--5km
DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_hexgrid_5km;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_hexgrid_5km AS 
SELECT
b.gridid_5,
SUM("SVlt_Score" * b.area_ratio) AS "SVlt_Score",

--1.3.1 Housing Conditions
SUM("VHt_Score" * b.area_ratio) AS "VHt_Score",
AVG("VH_PopHa" * b.area_ratio) AS "VH_PopHa",
AVG("VHn_PopHa" * b.area_ratio) AS "VHn_PopHa",
SUM("VHt_PopHa" * b.area_ratio) AS "VHt_PopHa",
AVG("VH_Pre1975" * b.area_ratio) AS "VH_Pre1975",
AVG("VHn_Pre1975" * b.area_ratio) AS "VHn_Pre1975",
SUM("VHtPre1975" * b.area_ratio) AS "VHtPre1975",
AVG("VH_NSuit" * b.area_ratio) AS "VH_NSuit",
AVG("VHn_NSuit" * b.area_ratio) AS "VHn_NSuit",
SUM("VHt_NSuit" * b.area_ratio) AS "VHt_NSuit",
AVG("VH_MntnAge" * b.area_ratio) AS "VH_MntnAge",
AVG("VHn_MntnAge" * b.area_ratio) AS "VHn_MntnAge",
SUM("VHt_MntnAge" * b.area_ratio) AS "VHt_MntnAge",
AVG("VH_Mntn1" * b.area_ratio) AS "VH_Mntn1",
AVG("VHn_Mntn1" * b.area_ratio) AS "VHn_Mntn1",
SUM("VHt_Mntn1" * b.area_ratio) AS "VHt_Mntn1",
AVG("VH_Renter" * b.area_ratio) AS "VH_Renter",
AVG("VHn_Renter" * b.area_ratio) AS "VHn_Renter",
SUM("VHt_Renter" * b.area_ratio) AS "VHt_Renter",
AVG("VH_NonResHa" * b.area_ratio) AS "VH_NonResHa",
AVG("VHn_NonResHa" * b.area_ratio) AS "VHn_NonResHa",
SUM("VHt_NonResHa" * b.area_ratio) AS "VHt_NonResHa",

--1.3.2 Social Connections
SUM("VFt_Score" * b.area_ratio) AS "VFt_Score",
AVG("VF_LivAlone" * b.area_ratio) AS "VF_LivAlone",
AVG("VFn_LivAlone" * b.area_ratio) AS "VFn_LivAlone" ,
SUM("VFt_LivAlone" * b.area_ratio) AS "VFt_LivAlone",
AVG("VF_LonPar3Kids" * b.area_ratio) AS "VF_LonPar3Kids",
AVG("VFn_LonPar3Kids" * b.area_ratio) AS "VFn_LonPar3Kids",
SUM("VFt_LonPar3Kids" * b.area_ratio) AS "VFt_LonPar3Kids",
AVG("VF_FamGT5" * b.area_ratio) AS "VF_FamGT5",
AVG("VFn_FamGT5" * b.area_ratio) AS "VFn_FamGT5",
SUM("VFt_FamGT5" * b.area_ratio) AS "VFt_FamGT5",
AVG("VF_MovedLT1" * b.area_ratio) AS "VF_MovedLT1",
AVG("VFn_MovedLT1" * b.area_ratio) AS "VFn_MovedLT1",
SUM("VFt_MovedLT1" * b.area_ratio) AS "VFt_MovedLT1",
AVG("VF_ImmLT5" * b.area_ratio) AS "VF_ImmLT5",
AVG("VFn_Imm_LT5" * b.area_ratio) AS "VFn_Imm_LT5",
SUM("VFt_ImmLT5" * b.area_ratio) AS"VFt_ImmLT5" ,
AVG("VF_NoWrkPlace" * b.area_ratio) AS "VF_NoWrkPlace",
AVG("VFn_NoWrkPlace" * b.area_ratio) AS "VFn_NoWrkPlace",
SUM("VFt_NoWrkPlace" * b.area_ratio) AS "VFt_NoWrkPlace",

--1.3.3 Individual Autonomy
SUM("VAt_Score" * b.area_ratio) AS "VAt_Score",
AVG("VA_NoEngFr" * b.area_ratio) AS "VA_NoEngFr",
AVG("VAn_NoEngFr" * b.area_ratio) AS "VAn_NoEngFr",
SUM("VAt_NoEngFr" * b.area_ratio) AS "VAt_NoEngFr",
AVG("VA_NoSecED" * b.area_ratio) AS "VA_NoSecED",
AVG("VAn_NoSecED" * b.area_ratio) AS "VAn_NoSecED",
SUM("VAt_NoSecED" * b.area_ratio) AS "VAt_NoSecED",
AVG("VA_AgeGT65" * b.area_ratio) AS "VA_AgeGT65",
AVG("VAn_AgeGT65" * b.area_ratio) AS "VAn_AgeGT65",
SUM("VAt_AgeGT65" * b.area_ratio) AS "VAt_AgeGT65",
AVG("VA_AgeLT6" * b.area_ratio) AS "VA_AgeLT6",
AVG("VAn_AgeLT6" * b.area_ratio) AS "VAn_AgeLT6",
SUM("VAt_AgeLT6" * b.area_ratio) AS "VAt_AgeLT6",
AVG("VA_Indigenous" * b.area_ratio) AS "VA_Indigenous",
AVG("VAn_Indigenous" * b.area_ratio) AS "VAn_Indigenous",
SUM("VAt_Indigenous" * b.area_ratio) AS "VAt_Indigenous",
AVG("VA_VisMinority" * b.area_ratio) AS "VA_VisMinority",
AVG("VAn_VisMinority" * b.area_ratio) AS "VAn_VisMinority",
SUM("VAt_VisMinority" * b.area_ratio) AS "VAt_VisMinority",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VA_AgeMedian" * b.area_ratio) AS "VA_AgeMedian",
AVG("VAn_AgeMedian" * b.area_ratio) AS "VAn_AgeMedian",
SUM("VAt_AgeMedian" * b.area_ratio) AS "VAt_AgeMedian",
AVG("VA_Health" * b.area_ratio) AS "VA_Health",
AVG("VAn_Health" * b.area_ratio) AS "VAn_Health",
SUM("VAt_Health" * b.area_ratio) AS "VAt_Health",
AVG("VA_PubTrans" * b.area_ratio) AS "VA_PubTrans",
AVG("VAn_PubTrans" * b.area_ratio) AS "VAn_PubTrans",
SUM("VAt_PubTrans" * b.area_ratio) AS "VAt_PubTrans",

--1.3.4 Financial Agency
SUM("VEt_Score" * b.area_ratio) AS "VEt_Score",
AVG("VE_ShltrGT30" * b.area_ratio) AS "VE_ShltrGT30",
AVG("VEn_ShltrGT30" * b.area_ratio) AS "VEn_ShltrGT30",
SUM("VEt_ShltrGT30" * b.area_ratio) AS "VEt_ShltrGT30",
AVG("VE_LowIncDec" * b.area_ratio) AS "VE_LowIncDec",
AVG("VEn_LowIncDec" * b.area_ratio) AS "VEn_LowIncDec",
SUM("VEt_LowIncDec" * b.area_ratio) AS "VEt_LowIncDec",
AVG("VE_Unemployed" * b.area_ratio) AS "VE_Unemployed",
AVG("VEn_Unemployed" * b.area_ratio) AS "VEn_Unemployed",
SUM("VEt_Unemployed" * b.area_ratio) AS "VEt_Unemployed",
AVG("VE_IncEmploy" * b.area_ratio) AS "VE_IncEmploy",
AVG("VEn_IncEmploy" * b.area_ratio) AS "VEn_IncEmploy",
SUM("VEt_IncEmploy" * b.area_ratio) AS "VEt_IncEmploy",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_IndivInc" * b.area_ratio) AS "VE_IndivInc",
AVG("VEn_IndivInc" * b.area_ratio) AS "VEn_IndivInc",
SUM("VEt_IndivInc" * b.area_ratio) AS "VEt_IndivInc",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_HshldInc" * b.area_ratio) AS "VE_HshldInc",
AVG("VEn_HshldInc" * b.area_ratio) AS "VEn_HshldInc",
SUM("VEt_HshldInc" * b.area_ratio) AS "VEt_HshldInc",
AVG("VE_Retail" * b.area_ratio) AS "VE_Retail",
AVG("VEn_Retail" * b.area_ratio) AS "VEn_Retail",
SUM("VEt_Retail" * b.area_ratio) AS "VEt_Retail",
AVG("VE_WorkNone" * b.area_ratio) AS "VE_WorkNone",
AVG("VEn_WorkNone" * b.area_ratio) AS "VEn_WorkNone" ,
SUM("VEt_WorkNone" * b.area_ratio) AS "VEt_WorkNone",
AVG("VE_WorkPart" * b.area_ratio) AS "VE_WorkPart",
AVG("VEn_WorkPart" * b.area_ratio) AS "VEn_WorkPart",
SUM("VEt_WorkPart" * b.area_ratio) AS "VEt_WorkPart",

c.geom

FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s a
LEFT JOIN boundaries."SAUID_HexGrid_5km_intersect" b ON a."Sauid" = b.sauid
LEFT JOIN boundaries."HexGrid_5km" c ON b.gridid_5 = c.gridid_5
GROUP BY b.gridid_5,c.geom;




--10km
DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_hexgrid_10km;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_hexgrid_10km AS 
SELECT
b.gridid_10,
SUM("SVlt_Score" * b.area_ratio) AS "SVlt_Score",

--1.3.1 Housing Conditions
SUM("VHt_Score" * b.area_ratio) AS "VHt_Score",
AVG("VH_PopHa" * b.area_ratio) AS "VH_PopHa",
AVG("VHn_PopHa" * b.area_ratio) AS "VHn_PopHa",
SUM("VHt_PopHa" * b.area_ratio) AS "VHt_PopHa",
AVG("VH_Pre1975" * b.area_ratio) AS "VH_Pre1975",
AVG("VHn_Pre1975" * b.area_ratio) AS "VHn_Pre1975",
SUM("VHtPre1975" * b.area_ratio) AS "VHtPre1975",
AVG("VH_NSuit" * b.area_ratio) AS "VH_NSuit",
AVG("VHn_NSuit" * b.area_ratio) AS "VHn_NSuit",
SUM("VHt_NSuit" * b.area_ratio) AS "VHt_NSuit",
AVG("VH_MntnAge" * b.area_ratio) AS "VH_MntnAge",
AVG("VHn_MntnAge" * b.area_ratio) AS "VHn_MntnAge",
SUM("VHt_MntnAge" * b.area_ratio) AS "VHt_MntnAge",
AVG("VH_Mntn1" * b.area_ratio) AS "VH_Mntn1",
AVG("VHn_Mntn1" * b.area_ratio) AS "VHn_Mntn1",
SUM("VHt_Mntn1" * b.area_ratio) AS "VHt_Mntn1",
AVG("VH_Renter" * b.area_ratio) AS "VH_Renter",
AVG("VHn_Renter" * b.area_ratio) AS "VHn_Renter",
SUM("VHt_Renter" * b.area_ratio) AS "VHt_Renter",
AVG("VH_NonResHa" * b.area_ratio) AS "VH_NonResHa",
AVG("VHn_NonResHa" * b.area_ratio) AS "VHn_NonResHa",
SUM("VHt_NonResHa" * b.area_ratio) AS "VHt_NonResHa",

--1.3.2 Social Connections
SUM("VFt_Score" * b.area_ratio) AS "VFt_Score",
AVG("VF_LivAlone" * b.area_ratio) AS "VF_LivAlone",
AVG("VFn_LivAlone" * b.area_ratio) AS "VFn_LivAlone" ,
SUM("VFt_LivAlone" * b.area_ratio) AS "VFt_LivAlone",
AVG("VF_LonPar3Kids" * b.area_ratio) AS "VF_LonPar3Kids",
AVG("VFn_LonPar3Kids" * b.area_ratio) AS "VFn_LonPar3Kids",
SUM("VFt_LonPar3Kids" * b.area_ratio) AS "VFt_LonPar3Kids",
AVG("VF_FamGT5" * b.area_ratio) AS "VF_FamGT5",
AVG("VFn_FamGT5" * b.area_ratio) AS "VFn_FamGT5",
SUM("VFt_FamGT5" * b.area_ratio) AS "VFt_FamGT5",
AVG("VF_MovedLT1" * b.area_ratio) AS "VF_MovedLT1",
AVG("VFn_MovedLT1" * b.area_ratio) AS "VFn_MovedLT1",
SUM("VFt_MovedLT1" * b.area_ratio) AS "VFt_MovedLT1",
AVG("VF_ImmLT5" * b.area_ratio) AS "VF_ImmLT5",
AVG("VFn_Imm_LT5" * b.area_ratio) AS "VFn_Imm_LT5",
SUM("VFt_ImmLT5" * b.area_ratio) AS"VFt_ImmLT5" ,
AVG("VF_NoWrkPlace" * b.area_ratio) AS "VF_NoWrkPlace",
AVG("VFn_NoWrkPlace" * b.area_ratio) AS "VFn_NoWrkPlace",
SUM("VFt_NoWrkPlace" * b.area_ratio) AS "VFt_NoWrkPlace",

--1.3.3 Individual Autonomy
SUM("VAt_Score" * b.area_ratio) AS "VAt_Score",
AVG("VA_NoEngFr" * b.area_ratio) AS "VA_NoEngFr",
AVG("VAn_NoEngFr" * b.area_ratio) AS "VAn_NoEngFr",
SUM("VAt_NoEngFr" * b.area_ratio) AS "VAt_NoEngFr",
AVG("VA_NoSecED" * b.area_ratio) AS "VA_NoSecED",
AVG("VAn_NoSecED" * b.area_ratio) AS "VAn_NoSecED",
SUM("VAt_NoSecED" * b.area_ratio) AS "VAt_NoSecED",
AVG("VA_AgeGT65" * b.area_ratio) AS "VA_AgeGT65",
AVG("VAn_AgeGT65" * b.area_ratio) AS "VAn_AgeGT65",
SUM("VAt_AgeGT65" * b.area_ratio) AS "VAt_AgeGT65",
AVG("VA_AgeLT6" * b.area_ratio) AS "VA_AgeLT6",
AVG("VAn_AgeLT6" * b.area_ratio) AS "VAn_AgeLT6",
SUM("VAt_AgeLT6" * b.area_ratio) AS "VAt_AgeLT6",
AVG("VA_Indigenous" * b.area_ratio) AS "VA_Indigenous",
AVG("VAn_Indigenous" * b.area_ratio) AS "VAn_Indigenous",
SUM("VAt_Indigenous" * b.area_ratio) AS "VAt_Indigenous",
AVG("VA_VisMinority" * b.area_ratio) AS "VA_VisMinority",
AVG("VAn_VisMinority" * b.area_ratio) AS "VAn_VisMinority",
SUM("VAt_VisMinority" * b.area_ratio) AS "VAt_VisMinority",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VA_AgeMedian" * b.area_ratio) AS "VA_AgeMedian",
AVG("VAn_AgeMedian" * b.area_ratio) AS "VAn_AgeMedian",
SUM("VAt_AgeMedian" * b.area_ratio) AS "VAt_AgeMedian",
AVG("VA_Health" * b.area_ratio) AS "VA_Health",
AVG("VAn_Health" * b.area_ratio) AS "VAn_Health",
SUM("VAt_Health" * b.area_ratio) AS "VAt_Health",
AVG("VA_PubTrans" * b.area_ratio) AS "VA_PubTrans",
AVG("VAn_PubTrans" * b.area_ratio) AS "VAn_PubTrans",
SUM("VAt_PubTrans" * b.area_ratio) AS "VAt_PubTrans",

--1.3.4 Financial Agency
SUM("VEt_Score" * b.area_ratio) AS "VEt_Score",
AVG("VE_ShltrGT30" * b.area_ratio) AS "VE_ShltrGT30",
AVG("VEn_ShltrGT30" * b.area_ratio) AS "VEn_ShltrGT30",
SUM("VEt_ShltrGT30" * b.area_ratio) AS "VEt_ShltrGT30",
AVG("VE_LowIncDec" * b.area_ratio) AS "VE_LowIncDec",
AVG("VEn_LowIncDec" * b.area_ratio) AS "VEn_LowIncDec",
SUM("VEt_LowIncDec" * b.area_ratio) AS "VEt_LowIncDec",
AVG("VE_Unemployed" * b.area_ratio) AS "VE_Unemployed",
AVG("VEn_Unemployed" * b.area_ratio) AS "VEn_Unemployed",
SUM("VEt_Unemployed" * b.area_ratio) AS "VEt_Unemployed",
AVG("VE_IncEmploy" * b.area_ratio) AS "VE_IncEmploy",
AVG("VEn_IncEmploy" * b.area_ratio) AS "VEn_IncEmploy",
SUM("VEt_IncEmploy" * b.area_ratio) AS "VEt_IncEmploy",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_IndivInc" * b.area_ratio) AS "VE_IndivInc",
AVG("VEn_IndivInc" * b.area_ratio) AS "VEn_IndivInc",
SUM("VEt_IndivInc" * b.area_ratio) AS "VEt_IndivInc",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_HshldInc" * b.area_ratio) AS "VE_HshldInc",
AVG("VEn_HshldInc" * b.area_ratio) AS "VEn_HshldInc",
SUM("VEt_HshldInc" * b.area_ratio) AS "VEt_HshldInc",
AVG("VE_Retail" * b.area_ratio) AS "VE_Retail",
AVG("VEn_Retail" * b.area_ratio) AS "VEn_Retail",
SUM("VEt_Retail" * b.area_ratio) AS "VEt_Retail",
AVG("VE_WorkNone" * b.area_ratio) AS "VE_WorkNone",
AVG("VEn_WorkNone" * b.area_ratio) AS "VEn_WorkNone" ,
SUM("VEt_WorkNone" * b.area_ratio) AS "VEt_WorkNone",
AVG("VE_WorkPart" * b.area_ratio) AS "VE_WorkPart",
AVG("VEn_WorkPart" * b.area_ratio) AS "VEn_WorkPart",
SUM("VEt_WorkPart" * b.area_ratio) AS "VEt_WorkPart",

c.geom

FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s a
LEFT JOIN boundaries."SAUID_HexGrid_10km_intersect" b ON a."Sauid" = b.sauid
LEFT JOIN boundaries."HexGrid_10km" c ON b.gridid_10 = c.gridid_10
GROUP BY b.gridid_10,c.geom;



--25km
DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_hexgrid_25km;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_hexgrid_25km AS 
SELECT
b.gridid_25,
SUM("SVlt_Score" * b.area_ratio) AS "SVlt_Score",

--1.3.1 Housing Conditions
SUM("VHt_Score" * b.area_ratio) AS "VHt_Score",
AVG("VH_PopHa" * b.area_ratio) AS "VH_PopHa",
AVG("VHn_PopHa" * b.area_ratio) AS "VHn_PopHa",
SUM("VHt_PopHa" * b.area_ratio) AS "VHt_PopHa",
AVG("VH_Pre1975" * b.area_ratio) AS "VH_Pre1975",
AVG("VHn_Pre1975" * b.area_ratio) AS "VHn_Pre1975",
SUM("VHtPre1975" * b.area_ratio) AS "VHtPre1975",
AVG("VH_NSuit" * b.area_ratio) AS "VH_NSuit",
AVG("VHn_NSuit" * b.area_ratio) AS "VHn_NSuit",
SUM("VHt_NSuit" * b.area_ratio) AS "VHt_NSuit",
AVG("VH_MntnAge" * b.area_ratio) AS "VH_MntnAge",
AVG("VHn_MntnAge" * b.area_ratio) AS "VHn_MntnAge",
SUM("VHt_MntnAge" * b.area_ratio) AS "VHt_MntnAge",
AVG("VH_Mntn1" * b.area_ratio) AS "VH_Mntn1",
AVG("VHn_Mntn1" * b.area_ratio) AS "VHn_Mntn1",
SUM("VHt_Mntn1" * b.area_ratio) AS "VHt_Mntn1",
AVG("VH_Renter" * b.area_ratio) AS "VH_Renter",
AVG("VHn_Renter" * b.area_ratio) AS "VHn_Renter",
SUM("VHt_Renter" * b.area_ratio) AS "VHt_Renter",
AVG("VH_NonResHa" * b.area_ratio) AS "VH_NonResHa",
AVG("VHn_NonResHa" * b.area_ratio) AS "VHn_NonResHa",
SUM("VHt_NonResHa" * b.area_ratio) AS "VHt_NonResHa",

--1.3.2 Social Connections
SUM("VFt_Score" * b.area_ratio) AS "VFt_Score",
AVG("VF_LivAlone" * b.area_ratio) AS "VF_LivAlone",
AVG("VFn_LivAlone" * b.area_ratio) AS "VFn_LivAlone" ,
SUM("VFt_LivAlone" * b.area_ratio) AS "VFt_LivAlone",
AVG("VF_LonPar3Kids" * b.area_ratio) AS "VF_LonPar3Kids",
AVG("VFn_LonPar3Kids" * b.area_ratio) AS "VFn_LonPar3Kids",
SUM("VFt_LonPar3Kids" * b.area_ratio) AS "VFt_LonPar3Kids",
AVG("VF_FamGT5" * b.area_ratio) AS "VF_FamGT5",
AVG("VFn_FamGT5" * b.area_ratio) AS "VFn_FamGT5",
SUM("VFt_FamGT5" * b.area_ratio) AS "VFt_FamGT5",
AVG("VF_MovedLT1" * b.area_ratio) AS "VF_MovedLT1",
AVG("VFn_MovedLT1" * b.area_ratio) AS "VFn_MovedLT1",
SUM("VFt_MovedLT1" * b.area_ratio) AS "VFt_MovedLT1",
AVG("VF_ImmLT5" * b.area_ratio) AS "VF_ImmLT5",
AVG("VFn_Imm_LT5" * b.area_ratio) AS "VFn_Imm_LT5",
SUM("VFt_ImmLT5" * b.area_ratio) AS"VFt_ImmLT5" ,
AVG("VF_NoWrkPlace" * b.area_ratio) AS "VF_NoWrkPlace",
AVG("VFn_NoWrkPlace" * b.area_ratio) AS "VFn_NoWrkPlace",
SUM("VFt_NoWrkPlace" * b.area_ratio) AS "VFt_NoWrkPlace",

--1.3.3 Individual Autonomy
SUM("VAt_Score" * b.area_ratio) AS "VAt_Score",
AVG("VA_NoEngFr" * b.area_ratio) AS "VA_NoEngFr",
AVG("VAn_NoEngFr" * b.area_ratio) AS "VAn_NoEngFr",
SUM("VAt_NoEngFr" * b.area_ratio) AS "VAt_NoEngFr",
AVG("VA_NoSecED" * b.area_ratio) AS "VA_NoSecED",
AVG("VAn_NoSecED" * b.area_ratio) AS "VAn_NoSecED",
SUM("VAt_NoSecED" * b.area_ratio) AS "VAt_NoSecED",
AVG("VA_AgeGT65" * b.area_ratio) AS "VA_AgeGT65",
AVG("VAn_AgeGT65" * b.area_ratio) AS "VAn_AgeGT65",
SUM("VAt_AgeGT65" * b.area_ratio) AS "VAt_AgeGT65",
AVG("VA_AgeLT6" * b.area_ratio) AS "VA_AgeLT6",
AVG("VAn_AgeLT6" * b.area_ratio) AS "VAn_AgeLT6",
SUM("VAt_AgeLT6" * b.area_ratio) AS "VAt_AgeLT6",
AVG("VA_Indigenous" * b.area_ratio) AS "VA_Indigenous",
AVG("VAn_Indigenous" * b.area_ratio) AS "VAn_Indigenous",
SUM("VAt_Indigenous" * b.area_ratio) AS "VAt_Indigenous",
AVG("VA_VisMinority" * b.area_ratio) AS "VA_VisMinority",
AVG("VAn_VisMinority" * b.area_ratio) AS "VAn_VisMinority",
SUM("VAt_VisMinority" * b.area_ratio) AS "VAt_VisMinority",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VA_AgeMedian" * b.area_ratio) AS "VA_AgeMedian",
AVG("VAn_AgeMedian" * b.area_ratio) AS "VAn_AgeMedian",
SUM("VAt_AgeMedian" * b.area_ratio) AS "VAt_AgeMedian",
AVG("VA_Health" * b.area_ratio) AS "VA_Health",
AVG("VAn_Health" * b.area_ratio) AS "VAn_Health",
SUM("VAt_Health" * b.area_ratio) AS "VAt_Health",
AVG("VA_PubTrans" * b.area_ratio) AS "VA_PubTrans",
AVG("VAn_PubTrans" * b.area_ratio) AS "VAn_PubTrans",
SUM("VAt_PubTrans" * b.area_ratio) AS "VAt_PubTrans",

--1.3.4 Financial Agency
SUM("VEt_Score" * b.area_ratio) AS "VEt_Score",
AVG("VE_ShltrGT30" * b.area_ratio) AS "VE_ShltrGT30",
AVG("VEn_ShltrGT30" * b.area_ratio) AS "VEn_ShltrGT30",
SUM("VEt_ShltrGT30" * b.area_ratio) AS "VEt_ShltrGT30",
AVG("VE_LowIncDec" * b.area_ratio) AS "VE_LowIncDec",
AVG("VEn_LowIncDec" * b.area_ratio) AS "VEn_LowIncDec",
SUM("VEt_LowIncDec" * b.area_ratio) AS "VEt_LowIncDec",
AVG("VE_Unemployed" * b.area_ratio) AS "VE_Unemployed",
AVG("VEn_Unemployed" * b.area_ratio) AS "VEn_Unemployed",
SUM("VEt_Unemployed" * b.area_ratio) AS "VEt_Unemployed",
AVG("VE_IncEmploy" * b.area_ratio) AS "VE_IncEmploy",
AVG("VEn_IncEmploy" * b.area_ratio) AS "VEn_IncEmploy",
SUM("VEt_IncEmploy" * b.area_ratio) AS "VEt_IncEmploy",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_IndivInc" * b.area_ratio) AS "VE_IndivInc",
AVG("VEn_IndivInc" * b.area_ratio) AS "VEn_IndivInc",
SUM("VEt_IndivInc" * b.area_ratio) AS "VEt_IndivInc",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_HshldInc" * b.area_ratio) AS "VE_HshldInc",
AVG("VEn_HshldInc" * b.area_ratio) AS "VEn_HshldInc",
SUM("VEt_HshldInc" * b.area_ratio) AS "VEt_HshldInc",
AVG("VE_Retail" * b.area_ratio) AS "VE_Retail",
AVG("VEn_Retail" * b.area_ratio) AS "VEn_Retail",
SUM("VEt_Retail" * b.area_ratio) AS "VEt_Retail",
AVG("VE_WorkNone" * b.area_ratio) AS "VE_WorkNone",
AVG("VEn_WorkNone" * b.area_ratio) AS "VEn_WorkNone" ,
SUM("VEt_WorkNone" * b.area_ratio) AS "VEt_WorkNone",
AVG("VE_WorkPart" * b.area_ratio) AS "VE_WorkPart",
AVG("VEn_WorkPart" * b.area_ratio) AS "VEn_WorkPart",
SUM("VEt_WorkPart" * b.area_ratio) AS "VEt_WorkPart",

c.geom

FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s a
LEFT JOIN boundaries."SAUID_HexGrid_25km_intersect" b ON a."Sauid" = b.sauid
LEFT JOIN boundaries."HexGrid_25km" c ON b.gridid_25 = c.gridid_25
GROUP BY b.gridid_25,c.geom;



--50km
DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_hexgrid_50km;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_hexgrid_50km AS 
SELECT
b.gridid_50,
SUM("SVlt_Score" * b.area_ratio) AS "SVlt_Score",

--1.3.1 Housing Conditions
SUM("VHt_Score" * b.area_ratio) AS "VHt_Score",
AVG("VH_PopHa" * b.area_ratio) AS "VH_PopHa",
AVG("VHn_PopHa" * b.area_ratio) AS "VHn_PopHa",
SUM("VHt_PopHa" * b.area_ratio) AS "VHt_PopHa",
AVG("VH_Pre1975" * b.area_ratio) AS "VH_Pre1975",
AVG("VHn_Pre1975" * b.area_ratio) AS "VHn_Pre1975",
SUM("VHtPre1975" * b.area_ratio) AS "VHtPre1975",
AVG("VH_NSuit" * b.area_ratio) AS "VH_NSuit",
AVG("VHn_NSuit" * b.area_ratio) AS "VHn_NSuit",
SUM("VHt_NSuit" * b.area_ratio) AS "VHt_NSuit",
AVG("VH_MntnAge" * b.area_ratio) AS "VH_MntnAge",
AVG("VHn_MntnAge" * b.area_ratio) AS "VHn_MntnAge",
SUM("VHt_MntnAge" * b.area_ratio) AS "VHt_MntnAge",
AVG("VH_Mntn1" * b.area_ratio) AS "VH_Mntn1",
AVG("VHn_Mntn1" * b.area_ratio) AS "VHn_Mntn1",
SUM("VHt_Mntn1" * b.area_ratio) AS "VHt_Mntn1",
AVG("VH_Renter" * b.area_ratio) AS "VH_Renter",
AVG("VHn_Renter" * b.area_ratio) AS "VHn_Renter",
SUM("VHt_Renter" * b.area_ratio) AS "VHt_Renter",
AVG("VH_NonResHa" * b.area_ratio) AS "VH_NonResHa",
AVG("VHn_NonResHa" * b.area_ratio) AS "VHn_NonResHa",
SUM("VHt_NonResHa" * b.area_ratio) AS "VHt_NonResHa",

--1.3.2 Social Connections
SUM("VFt_Score" * b.area_ratio) AS "VFt_Score",
AVG("VF_LivAlone" * b.area_ratio) AS "VF_LivAlone",
AVG("VFn_LivAlone" * b.area_ratio) AS "VFn_LivAlone" ,
SUM("VFt_LivAlone" * b.area_ratio) AS "VFt_LivAlone",
AVG("VF_LonPar3Kids" * b.area_ratio) AS "VF_LonPar3Kids",
AVG("VFn_LonPar3Kids" * b.area_ratio) AS "VFn_LonPar3Kids",
SUM("VFt_LonPar3Kids" * b.area_ratio) AS "VFt_LonPar3Kids",
AVG("VF_FamGT5" * b.area_ratio) AS "VF_FamGT5",
AVG("VFn_FamGT5" * b.area_ratio) AS "VFn_FamGT5",
SUM("VFt_FamGT5" * b.area_ratio) AS "VFt_FamGT5",
AVG("VF_MovedLT1" * b.area_ratio) AS "VF_MovedLT1",
AVG("VFn_MovedLT1" * b.area_ratio) AS "VFn_MovedLT1",
SUM("VFt_MovedLT1" * b.area_ratio) AS "VFt_MovedLT1",
AVG("VF_ImmLT5" * b.area_ratio) AS "VF_ImmLT5",
AVG("VFn_Imm_LT5" * b.area_ratio) AS "VFn_Imm_LT5",
SUM("VFt_ImmLT5" * b.area_ratio) AS"VFt_ImmLT5" ,
AVG("VF_NoWrkPlace" * b.area_ratio) AS "VF_NoWrkPlace",
AVG("VFn_NoWrkPlace" * b.area_ratio) AS "VFn_NoWrkPlace",
SUM("VFt_NoWrkPlace" * b.area_ratio) AS "VFt_NoWrkPlace",

--1.3.3 Individual Autonomy
SUM("VAt_Score" * b.area_ratio) AS "VAt_Score",
AVG("VA_NoEngFr" * b.area_ratio) AS "VA_NoEngFr",
AVG("VAn_NoEngFr" * b.area_ratio) AS "VAn_NoEngFr",
SUM("VAt_NoEngFr" * b.area_ratio) AS "VAt_NoEngFr",
AVG("VA_NoSecED" * b.area_ratio) AS "VA_NoSecED",
AVG("VAn_NoSecED" * b.area_ratio) AS "VAn_NoSecED",
SUM("VAt_NoSecED" * b.area_ratio) AS "VAt_NoSecED",
AVG("VA_AgeGT65" * b.area_ratio) AS "VA_AgeGT65",
AVG("VAn_AgeGT65" * b.area_ratio) AS "VAn_AgeGT65",
SUM("VAt_AgeGT65" * b.area_ratio) AS "VAt_AgeGT65",
AVG("VA_AgeLT6" * b.area_ratio) AS "VA_AgeLT6",
AVG("VAn_AgeLT6" * b.area_ratio) AS "VAn_AgeLT6",
SUM("VAt_AgeLT6" * b.area_ratio) AS "VAt_AgeLT6",
AVG("VA_Indigenous" * b.area_ratio) AS "VA_Indigenous",
AVG("VAn_Indigenous" * b.area_ratio) AS "VAn_Indigenous",
SUM("VAt_Indigenous" * b.area_ratio) AS "VAt_Indigenous",
AVG("VA_VisMinority" * b.area_ratio) AS "VA_VisMinority",
AVG("VAn_VisMinority" * b.area_ratio) AS "VAn_VisMinority",
SUM("VAt_VisMinority" * b.area_ratio) AS "VAt_VisMinority",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VA_AgeMedian" * b.area_ratio) AS "VA_AgeMedian",
AVG("VAn_AgeMedian" * b.area_ratio) AS "VAn_AgeMedian",
SUM("VAt_AgeMedian" * b.area_ratio) AS "VAt_AgeMedian",
AVG("VA_Health" * b.area_ratio) AS "VA_Health",
AVG("VAn_Health" * b.area_ratio) AS "VAn_Health",
SUM("VAt_Health" * b.area_ratio) AS "VAt_Health",
AVG("VA_PubTrans" * b.area_ratio) AS "VA_PubTrans",
AVG("VAn_PubTrans" * b.area_ratio) AS "VAn_PubTrans",
SUM("VAt_PubTrans" * b.area_ratio) AS "VAt_PubTrans",

--1.3.4 Financial Agency
SUM("VEt_Score" * b.area_ratio) AS "VEt_Score",
AVG("VE_ShltrGT30" * b.area_ratio) AS "VE_ShltrGT30",
AVG("VEn_ShltrGT30" * b.area_ratio) AS "VEn_ShltrGT30",
SUM("VEt_ShltrGT30" * b.area_ratio) AS "VEt_ShltrGT30",
AVG("VE_LowIncDec" * b.area_ratio) AS "VE_LowIncDec",
AVG("VEn_LowIncDec" * b.area_ratio) AS "VEn_LowIncDec",
SUM("VEt_LowIncDec" * b.area_ratio) AS "VEt_LowIncDec",
AVG("VE_Unemployed" * b.area_ratio) AS "VE_Unemployed",
AVG("VEn_Unemployed" * b.area_ratio) AS "VEn_Unemployed",
SUM("VEt_Unemployed" * b.area_ratio) AS "VEt_Unemployed",
AVG("VE_IncEmploy" * b.area_ratio) AS "VE_IncEmploy",
AVG("VEn_IncEmploy" * b.area_ratio) AS "VEn_IncEmploy",
SUM("VEt_IncEmploy" * b.area_ratio) AS "VEt_IncEmploy",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_IndivInc" * b.area_ratio) AS "VE_IndivInc",
AVG("VEn_IndivInc" * b.area_ratio) AS "VEn_IndivInc",
SUM("VEt_IndivInc" * b.area_ratio) AS "VEt_IndivInc",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_HshldInc" * b.area_ratio) AS "VE_HshldInc",
AVG("VEn_HshldInc" * b.area_ratio) AS "VEn_HshldInc",
SUM("VEt_HshldInc" * b.area_ratio) AS "VEt_HshldInc",
AVG("VE_Retail" * b.area_ratio) AS "VE_Retail",
AVG("VEn_Retail" * b.area_ratio) AS "VEn_Retail",
SUM("VEt_Retail" * b.area_ratio) AS "VEt_Retail",
AVG("VE_WorkNone" * b.area_ratio) AS "VE_WorkNone",
AVG("VEn_WorkNone" * b.area_ratio) AS "VEn_WorkNone" ,
SUM("VEt_WorkNone" * b.area_ratio) AS "VEt_WorkNone",
AVG("VE_WorkPart" * b.area_ratio) AS "VE_WorkPart",
AVG("VEn_WorkPart" * b.area_ratio) AS "VEn_WorkPart",
SUM("VEt_WorkPart" * b.area_ratio) AS "VEt_WorkPart",

c.geom

FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s a
LEFT JOIN boundaries."SAUID_HexGrid_50km_intersect" b ON a."Sauid" = b.sauid
LEFT JOIN boundaries."HexGrid_50km" c ON b.gridid_50 = c.gridid_50
GROUP BY b.gridid_50,c.geom;



--100km
DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_hexgrid_100km;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_hexgrid_100km AS 
SELECT
b.gridid_100,
SUM("SVlt_Score" * b.area_ratio) AS "SVlt_Score",

--1.3.1 Housing Conditions
SUM("VHt_Score" * b.area_ratio) AS "VHt_Score",
AVG("VH_PopHa" * b.area_ratio) AS "VH_PopHa",
AVG("VHn_PopHa" * b.area_ratio) AS "VHn_PopHa",
SUM("VHt_PopHa" * b.area_ratio) AS "VHt_PopHa",
AVG("VH_Pre1975" * b.area_ratio) AS "VH_Pre1975",
AVG("VHn_Pre1975" * b.area_ratio) AS "VHn_Pre1975",
SUM("VHtPre1975" * b.area_ratio) AS "VHtPre1975",
AVG("VH_NSuit" * b.area_ratio) AS "VH_NSuit",
AVG("VHn_NSuit" * b.area_ratio) AS "VHn_NSuit",
SUM("VHt_NSuit" * b.area_ratio) AS "VHt_NSuit",
AVG("VH_MntnAge" * b.area_ratio) AS "VH_MntnAge",
AVG("VHn_MntnAge" * b.area_ratio) AS "VHn_MntnAge",
SUM("VHt_MntnAge" * b.area_ratio) AS "VHt_MntnAge",
AVG("VH_Mntn1" * b.area_ratio) AS "VH_Mntn1",
AVG("VHn_Mntn1" * b.area_ratio) AS "VHn_Mntn1",
SUM("VHt_Mntn1" * b.area_ratio) AS "VHt_Mntn1",
AVG("VH_Renter" * b.area_ratio) AS "VH_Renter",
AVG("VHn_Renter" * b.area_ratio) AS "VHn_Renter",
SUM("VHt_Renter" * b.area_ratio) AS "VHt_Renter",
AVG("VH_NonResHa" * b.area_ratio) AS "VH_NonResHa",
AVG("VHn_NonResHa" * b.area_ratio) AS "VHn_NonResHa",
SUM("VHt_NonResHa" * b.area_ratio) AS "VHt_NonResHa",

--1.3.2 Social Connections
SUM("VFt_Score" * b.area_ratio) AS "VFt_Score",
AVG("VF_LivAlone" * b.area_ratio) AS "VF_LivAlone",
AVG("VFn_LivAlone" * b.area_ratio) AS "VFn_LivAlone" ,
SUM("VFt_LivAlone" * b.area_ratio) AS "VFt_LivAlone",
AVG("VF_LonPar3Kids" * b.area_ratio) AS "VF_LonPar3Kids",
AVG("VFn_LonPar3Kids" * b.area_ratio) AS "VFn_LonPar3Kids",
SUM("VFt_LonPar3Kids" * b.area_ratio) AS "VFt_LonPar3Kids",
AVG("VF_FamGT5" * b.area_ratio) AS "VF_FamGT5",
AVG("VFn_FamGT5" * b.area_ratio) AS "VFn_FamGT5",
SUM("VFt_FamGT5" * b.area_ratio) AS "VFt_FamGT5",
AVG("VF_MovedLT1" * b.area_ratio) AS "VF_MovedLT1",
AVG("VFn_MovedLT1" * b.area_ratio) AS "VFn_MovedLT1",
SUM("VFt_MovedLT1" * b.area_ratio) AS "VFt_MovedLT1",
AVG("VF_ImmLT5" * b.area_ratio) AS "VF_ImmLT5",
AVG("VFn_Imm_LT5" * b.area_ratio) AS "VFn_Imm_LT5",
SUM("VFt_ImmLT5" * b.area_ratio) AS"VFt_ImmLT5" ,
AVG("VF_NoWrkPlace" * b.area_ratio) AS "VF_NoWrkPlace",
AVG("VFn_NoWrkPlace" * b.area_ratio) AS "VFn_NoWrkPlace",
SUM("VFt_NoWrkPlace" * b.area_ratio) AS "VFt_NoWrkPlace",

--1.3.3 Individual Autonomy
SUM("VAt_Score" * b.area_ratio) AS "VAt_Score",
AVG("VA_NoEngFr" * b.area_ratio) AS "VA_NoEngFr",
AVG("VAn_NoEngFr" * b.area_ratio) AS "VAn_NoEngFr",
SUM("VAt_NoEngFr" * b.area_ratio) AS "VAt_NoEngFr",
AVG("VA_NoSecED" * b.area_ratio) AS "VA_NoSecED",
AVG("VAn_NoSecED" * b.area_ratio) AS "VAn_NoSecED",
SUM("VAt_NoSecED" * b.area_ratio) AS "VAt_NoSecED",
AVG("VA_AgeGT65" * b.area_ratio) AS "VA_AgeGT65",
AVG("VAn_AgeGT65" * b.area_ratio) AS "VAn_AgeGT65",
SUM("VAt_AgeGT65" * b.area_ratio) AS "VAt_AgeGT65",
AVG("VA_AgeLT6" * b.area_ratio) AS "VA_AgeLT6",
AVG("VAn_AgeLT6" * b.area_ratio) AS "VAn_AgeLT6",
SUM("VAt_AgeLT6" * b.area_ratio) AS "VAt_AgeLT6",
AVG("VA_Indigenous" * b.area_ratio) AS "VA_Indigenous",
AVG("VAn_Indigenous" * b.area_ratio) AS "VAn_Indigenous",
SUM("VAt_Indigenous" * b.area_ratio) AS "VAt_Indigenous",
AVG("VA_VisMinority" * b.area_ratio) AS "VA_VisMinority",
AVG("VAn_VisMinority" * b.area_ratio) AS "VAn_VisMinority",
SUM("VAt_VisMinority" * b.area_ratio) AS "VAt_VisMinority",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VA_AgeMedian" * b.area_ratio) AS "VA_AgeMedian",
AVG("VAn_AgeMedian" * b.area_ratio) AS "VAn_AgeMedian",
SUM("VAt_AgeMedian" * b.area_ratio) AS "VAt_AgeMedian",
AVG("VA_Health" * b.area_ratio) AS "VA_Health",
AVG("VAn_Health" * b.area_ratio) AS "VAn_Health",
SUM("VAt_Health" * b.area_ratio) AS "VAt_Health",
AVG("VA_PubTrans" * b.area_ratio) AS "VA_PubTrans",
AVG("VAn_PubTrans" * b.area_ratio) AS "VAn_PubTrans",
SUM("VAt_PubTrans" * b.area_ratio) AS "VAt_PubTrans",

--1.3.4 Financial Agency
SUM("VEt_Score" * b.area_ratio) AS "VEt_Score",
AVG("VE_ShltrGT30" * b.area_ratio) AS "VE_ShltrGT30",
AVG("VEn_ShltrGT30" * b.area_ratio) AS "VEn_ShltrGT30",
SUM("VEt_ShltrGT30" * b.area_ratio) AS "VEt_ShltrGT30",
AVG("VE_LowIncDec" * b.area_ratio) AS "VE_LowIncDec",
AVG("VEn_LowIncDec" * b.area_ratio) AS "VEn_LowIncDec",
SUM("VEt_LowIncDec" * b.area_ratio) AS "VEt_LowIncDec",
AVG("VE_Unemployed" * b.area_ratio) AS "VE_Unemployed",
AVG("VEn_Unemployed" * b.area_ratio) AS "VEn_Unemployed",
SUM("VEt_Unemployed" * b.area_ratio) AS "VEt_Unemployed",
AVG("VE_IncEmploy" * b.area_ratio) AS "VE_IncEmploy",
AVG("VEn_IncEmploy" * b.area_ratio) AS "VEn_IncEmploy",
SUM("VEt_IncEmploy" * b.area_ratio) AS "VEt_IncEmploy",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_IndivInc" * b.area_ratio) AS "VE_IndivInc",
AVG("VEn_IndivInc" * b.area_ratio) AS "VEn_IndivInc",
SUM("VEt_IndivInc" * b.area_ratio) AS "VEt_IndivInc",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_HshldInc" * b.area_ratio) AS "VE_HshldInc",
AVG("VEn_HshldInc" * b.area_ratio) AS "VEn_HshldInc",
SUM("VEt_HshldInc" * b.area_ratio) AS "VEt_HshldInc",
AVG("VE_Retail" * b.area_ratio) AS "VE_Retail",
AVG("VEn_Retail" * b.area_ratio) AS "VEn_Retail",
SUM("VEt_Retail" * b.area_ratio) AS "VEt_Retail",
AVG("VE_WorkNone" * b.area_ratio) AS "VE_WorkNone",
AVG("VEn_WorkNone" * b.area_ratio) AS "VEn_WorkNone" ,
SUM("VEt_WorkNone" * b.area_ratio) AS "VEt_WorkNone",
AVG("VE_WorkPart" * b.area_ratio) AS "VE_WorkPart",
AVG("VEn_WorkPart" * b.area_ratio) AS "VEn_WorkPart",
SUM("VEt_WorkPart" * b.area_ratio) AS "VEt_WorkPart",

c.geom

FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s a
LEFT JOIN boundaries."SAUID_HexGrid_100km_intersect" b ON a."Sauid" = b.sauid
LEFT JOIN boundaries."HexGrid_100km" c ON b.gridid_100 = c.gridid_100
GROUP BY b.gridid_100,c.geom;



--global fabric
DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_indicators_hexgrid_global_fabric;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_indicators_hexgrid_global_fabric AS 
SELECT
b.gridid,
SUM("SVlt_Score" * b.area_ratio) AS "SVlt_Score",

--1.3.1 Housing Conditions
SUM("VHt_Score" * b.area_ratio) AS "VHt_Score",
AVG("VH_PopHa" * b.area_ratio) AS "VH_PopHa",
AVG("VHn_PopHa" * b.area_ratio) AS "VHn_PopHa",
SUM("VHt_PopHa" * b.area_ratio) AS "VHt_PopHa",
AVG("VH_Pre1975" * b.area_ratio) AS "VH_Pre1975",
AVG("VHn_Pre1975" * b.area_ratio) AS "VHn_Pre1975",
SUM("VHtPre1975" * b.area_ratio) AS "VHtPre1975",
AVG("VH_NSuit" * b.area_ratio) AS "VH_NSuit",
AVG("VHn_NSuit" * b.area_ratio) AS "VHn_NSuit",
SUM("VHt_NSuit" * b.area_ratio) AS "VHt_NSuit",
AVG("VH_MntnAge" * b.area_ratio) AS "VH_MntnAge",
AVG("VHn_MntnAge" * b.area_ratio) AS "VHn_MntnAge",
SUM("VHt_MntnAge" * b.area_ratio) AS "VHt_MntnAge",
AVG("VH_Mntn1" * b.area_ratio) AS "VH_Mntn1",
AVG("VHn_Mntn1" * b.area_ratio) AS "VHn_Mntn1",
SUM("VHt_Mntn1" * b.area_ratio) AS "VHt_Mntn1",
AVG("VH_Renter" * b.area_ratio) AS "VH_Renter",
AVG("VHn_Renter" * b.area_ratio) AS "VHn_Renter",
SUM("VHt_Renter" * b.area_ratio) AS "VHt_Renter",
AVG("VH_NonResHa" * b.area_ratio) AS "VH_NonResHa",
AVG("VHn_NonResHa" * b.area_ratio) AS "VHn_NonResHa",
SUM("VHt_NonResHa" * b.area_ratio) AS "VHt_NonResHa",

--1.3.2 Social Connections
SUM("VFt_Score" * b.area_ratio) AS "VFt_Score",
AVG("VF_LivAlone" * b.area_ratio) AS "VF_LivAlone",
AVG("VFn_LivAlone" * b.area_ratio) AS "VFn_LivAlone" ,
SUM("VFt_LivAlone" * b.area_ratio) AS "VFt_LivAlone",
AVG("VF_LonPar3Kids" * b.area_ratio) AS "VF_LonPar3Kids",
AVG("VFn_LonPar3Kids" * b.area_ratio) AS "VFn_LonPar3Kids",
SUM("VFt_LonPar3Kids" * b.area_ratio) AS "VFt_LonPar3Kids",
AVG("VF_FamGT5" * b.area_ratio) AS "VF_FamGT5",
AVG("VFn_FamGT5" * b.area_ratio) AS "VFn_FamGT5",
SUM("VFt_FamGT5" * b.area_ratio) AS "VFt_FamGT5",
AVG("VF_MovedLT1" * b.area_ratio) AS "VF_MovedLT1",
AVG("VFn_MovedLT1" * b.area_ratio) AS "VFn_MovedLT1",
SUM("VFt_MovedLT1" * b.area_ratio) AS "VFt_MovedLT1",
AVG("VF_ImmLT5" * b.area_ratio) AS "VF_ImmLT5",
AVG("VFn_Imm_LT5" * b.area_ratio) AS "VFn_Imm_LT5",
SUM("VFt_ImmLT5" * b.area_ratio) AS"VFt_ImmLT5" ,
AVG("VF_NoWrkPlace" * b.area_ratio) AS "VF_NoWrkPlace",
AVG("VFn_NoWrkPlace" * b.area_ratio) AS "VFn_NoWrkPlace",
SUM("VFt_NoWrkPlace" * b.area_ratio) AS "VFt_NoWrkPlace",

--1.3.3 Individual Autonomy
SUM("VAt_Score" * b.area_ratio) AS "VAt_Score",
AVG("VA_NoEngFr" * b.area_ratio) AS "VA_NoEngFr",
AVG("VAn_NoEngFr" * b.area_ratio) AS "VAn_NoEngFr",
SUM("VAt_NoEngFr" * b.area_ratio) AS "VAt_NoEngFr",
AVG("VA_NoSecED" * b.area_ratio) AS "VA_NoSecED",
AVG("VAn_NoSecED" * b.area_ratio) AS "VAn_NoSecED",
SUM("VAt_NoSecED" * b.area_ratio) AS "VAt_NoSecED",
AVG("VA_AgeGT65" * b.area_ratio) AS "VA_AgeGT65",
AVG("VAn_AgeGT65" * b.area_ratio) AS "VAn_AgeGT65",
SUM("VAt_AgeGT65" * b.area_ratio) AS "VAt_AgeGT65",
AVG("VA_AgeLT6" * b.area_ratio) AS "VA_AgeLT6",
AVG("VAn_AgeLT6" * b.area_ratio) AS "VAn_AgeLT6",
SUM("VAt_AgeLT6" * b.area_ratio) AS "VAt_AgeLT6",
AVG("VA_Indigenous" * b.area_ratio) AS "VA_Indigenous",
AVG("VAn_Indigenous" * b.area_ratio) AS "VAn_Indigenous",
SUM("VAt_Indigenous" * b.area_ratio) AS "VAt_Indigenous",
AVG("VA_VisMinority" * b.area_ratio) AS "VA_VisMinority",
AVG("VAn_VisMinority" * b.area_ratio) AS "VAn_VisMinority",
SUM("VAt_VisMinority" * b.area_ratio) AS "VAt_VisMinority",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VA_AgeMedian" * b.area_ratio) AS "VA_AgeMedian",
AVG("VAn_AgeMedian" * b.area_ratio) AS "VAn_AgeMedian",
SUM("VAt_AgeMedian" * b.area_ratio) AS "VAt_AgeMedian",
AVG("VA_Health" * b.area_ratio) AS "VA_Health",
AVG("VAn_Health" * b.area_ratio) AS "VAn_Health",
SUM("VAt_Health" * b.area_ratio) AS "VAt_Health",
AVG("VA_PubTrans" * b.area_ratio) AS "VA_PubTrans",
AVG("VAn_PubTrans" * b.area_ratio) AS "VAn_PubTrans",
SUM("VAt_PubTrans" * b.area_ratio) AS "VAt_PubTrans",

--1.3.4 Financial Agency
SUM("VEt_Score" * b.area_ratio) AS "VEt_Score",
AVG("VE_ShltrGT30" * b.area_ratio) AS "VE_ShltrGT30",
AVG("VEn_ShltrGT30" * b.area_ratio) AS "VEn_ShltrGT30",
SUM("VEt_ShltrGT30" * b.area_ratio) AS "VEt_ShltrGT30",
AVG("VE_LowIncDec" * b.area_ratio) AS "VE_LowIncDec",
AVG("VEn_LowIncDec" * b.area_ratio) AS "VEn_LowIncDec",
SUM("VEt_LowIncDec" * b.area_ratio) AS "VEt_LowIncDec",
AVG("VE_Unemployed" * b.area_ratio) AS "VE_Unemployed",
AVG("VEn_Unemployed" * b.area_ratio) AS "VEn_Unemployed",
SUM("VEt_Unemployed" * b.area_ratio) AS "VEt_Unemployed",
AVG("VE_IncEmploy" * b.area_ratio) AS "VE_IncEmploy",
AVG("VEn_IncEmploy" * b.area_ratio) AS "VEn_IncEmploy",
SUM("VEt_IncEmploy" * b.area_ratio) AS "VEt_IncEmploy",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_IndivInc" * b.area_ratio) AS "VE_IndivInc",
AVG("VEn_IndivInc" * b.area_ratio) AS "VEn_IndivInc",
SUM("VEt_IndivInc" * b.area_ratio) AS "VEt_IndivInc",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_HshldInc" * b.area_ratio) AS "VE_HshldInc",
AVG("VEn_HshldInc" * b.area_ratio) AS "VEn_HshldInc",
SUM("VEt_HshldInc" * b.area_ratio) AS "VEt_HshldInc",
AVG("VE_Retail" * b.area_ratio) AS "VE_Retail",
AVG("VEn_Retail" * b.area_ratio) AS "VEn_Retail",
SUM("VEt_Retail" * b.area_ratio) AS "VEt_Retail",
AVG("VE_WorkNone" * b.area_ratio) AS "VE_WorkNone",
AVG("VEn_WorkNone" * b.area_ratio) AS "VEn_WorkNone" ,
SUM("VEt_WorkNone" * b.area_ratio) AS "VEt_WorkNone",
AVG("VE_WorkPart" * b.area_ratio) AS "VE_WorkPart",
AVG("VEn_WorkPart" * b.area_ratio) AS "VEn_WorkPart",
SUM("VEt_WorkPart" * b.area_ratio) AS "VEt_WorkPart",

c.geom

FROM results_nhsl_social_fabric.nhsl_social_fabric_indicators_s a
LEFT JOIN boundaries."SAUID_HexGrid_GlobalFabric_intersect" b ON a."Sauid" = b.sauid
LEFT JOIN boundaries."HexGrid_GlobalFabric" c ON b.gridid = c.gridid
GROUP BY b.gridid,c.geom;